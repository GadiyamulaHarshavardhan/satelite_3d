<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realistic Satellite Orbital System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #0a0a0a;
            color: #00ff00;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
            gap: 10px;
            padding: 10px;
        }

        .main-view {
            flex: 1;
            position: relative;
            background: #000;
            border: 2px solid #00ff00;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
        }

        canvas {
            width: 100% !important;
            height: 100% !important;
            display: block;
        }

        .sidebar {
            width: 320px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #00ff00;
            border-radius: 5px;
            padding: 15px;
            overflow-y: auto;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
            font-size: 0.85em;
        }

        .sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: #00ff00;
            border-radius: 4px;
        }

        h1 {
            font-size: 1.1em;
            margin-bottom: 12px;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 8px;
            color: #00ff00;
        }

        h2 {
            font-size: 0.95em;
            margin: 12px 0 8px;
            color: #00dd00;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 12px 0;
        }

        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 6px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.75em;
            transition: all 0.3s;
        }

        button:hover {
            background: #00dd00;
            transform: scale(1.05);
        }

        button.active {
            background: #ff00ff;
            color: #fff;
        }

        .info-box {
            background: rgba(0, 255, 0, 0.1);
            border-left: 3px solid #00ff00;
            padding: 8px;
            margin: 8px 0;
            border-radius: 3px;
            font-size: 0.8em;
            line-height: 1.6;
        }

        .satellite-item {
            background: rgba(0, 255, 0, 0.08);
            border: 1px solid rgba(0, 255, 0, 0.3);
            padding: 8px;
            margin: 6px 0;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8em;
        }

        .satellite-item:hover {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.15);
        }

        .satellite-item.active {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.25);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
        }

        .sat-name {
            font-weight: bold;
            color: #00ff00;
            margin-bottom: 3px;
        }

        .sat-data {
            color: #00dd00;
            margin: 2px 0;
            font-size: 0.75em;
        }

        .overlay {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #00ff00;
            padding: 12px;
            border-radius: 3px;
            z-index: 100;
            font-size: 0.85em;
            max-width: 280px;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }

        .time {
            font-weight: bold;
            color: #00ff00;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .stat {
            color: #00dd00;
            margin: 3px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-view">
            <canvas id="canvas"></canvas>
            <div class="overlay">
                <div class="time">‚è±Ô∏è <span id="time">00:00:00</span></div>
                <div class="stat">üì° MODE: <span id="mode">3D SPACE</span></div>
                <div class="stat">üõ∞Ô∏è SATELLITES: <span id="count">7</span></div>
                <div class="stat">üåç EARTH RADIUS: 6,371 km</div>
                <div class="stat">‚öôÔ∏è SIMULATION: 1000x</div>
            </div>
        </div>

        <div class="sidebar">
            <h1>üõ∞Ô∏è ORBITAL SYSTEM</h1>

            <div class="controls">
                <button onclick="switchView()" id="viewBtn">3D ‚Üí 2D</button>
                <button onclick="toggleSim()" id="simBtn">‚è∏Ô∏è PAUSE</button>
                <button onclick="resetView()">üîÑ RESET</button>
                <button onclick="speedUp()" id="speedBtn">‚è© 1000x</button>
            </div>

            <div class="info-box">
                <strong>ORBITAL MECHANICS</strong>
                <div style="font-size: 0.75em; margin-top: 6px;">
                    Real physics-based satellite rotations
                    <br>Kepler equations solver
                    <br>7 satellites with unique orbits
                </div>
            </div>

            <h2>üìç SATELLITES (7)</h2>
            <div id="satList"></div>

            <h2>üìä SELECTED</h2>
            <div class="info-box" id="selectedInfo">
                Click satellite to view details
            </div>

            <h2>üî¨ PHYSICS</h2>
            <div class="info-box">
                <div id="physicsInfo">No selection</div>
            </div>
        </div>
    </div>

    <script>
        // ========== PHYSICS ENGINE ==========
        class OrbitalPhysics {
            constructor() {
                this.GM = 3.986e5; // Earth's gravitational parameter (km^3/s^2)
                this.EARTH_RADIUS = 6371; // km
                this.DEG_TO_RAD = Math.PI / 180;
                this.RAD_TO_DEG = 180 / Math.PI;
                this.time = 0; // Simulation time in seconds
                this.speed = 1000; // 1000x speed
            }

            // Calculate satellite position using Kepler's equations
            calculatePosition(satellite, t) {
                // Orbital elements
                const a = satellite.semiMajor; // Semi-major axis (km)
                const e = satellite.eccentricity;
                const i = satellite.inclination * this.DEG_TO_RAD;
                const Omega = satellite.raan * this.DEG_TO_RAD; // Right ascension of ascending node
                const omega = satellite.argPeriapsis * this.DEG_TO_RAD; // Argument of periapsis
                
                // Mean motion (radians per second)
                const n = Math.sqrt(this.GM / (a * a * a));
                
                // Mean anomaly
                const M = satellite.meanAnomaly * this.DEG_TO_RAD + n * t;
                
                // Solve Kepler's equation (Newton-Raphson)
                let E = M;
                for (let iter = 0; iter < 10; iter++) {
                    E = M + e * Math.sin(E);
                }
                
                // True anomaly
                const nu = 2 * Math.atan2(
                    Math.sqrt(1 + e) * Math.sin(E / 2),
                    Math.sqrt(1 - e) * Math.cos(E / 2)
                );
                
                // Distance from focus (Earth)
                const r = a * (1 - e * e) / (1 + e * Math.cos(nu));
                
                // Orbital plane coordinates
                const x_orb = r * Math.cos(nu);
                const y_orb = r * Math.sin(nu);
                const z_orb = 0;
                
                // Transform to Earth-centered frame
                const cos_omega = Math.cos(omega);
                const sin_omega = Math.sin(omega);
                const cos_Omega = Math.cos(Omega);
                const sin_Omega = Math.sin(Omega);
                const cos_i = Math.cos(i);
                const sin_i = Math.sin(i);
                
                const x = (cos_omega * cos_Omega - sin_omega * sin_Omega * cos_i) * x_orb +
                         (-sin_omega * cos_Omega - cos_omega * sin_Omega * cos_i) * y_orb;
                const y = (cos_omega * sin_Omega + sin_omega * cos_Omega * cos_i) * x_orb +
                         (-sin_omega * sin_Omega + cos_omega * cos_Omega * cos_i) * y_orb;
                const z = sin_omega * sin_i * x_orb + cos_omega * sin_i * y_orb;
                
                // Velocity (circular approximation for visualization)
                const v = Math.sqrt(this.GM * (2 / r - 1 / a));
                const altitude = r - this.EARTH_RADIUS;
                const period = 2 * Math.PI / n; // seconds
                
                return { x, y, z, r, v, altitude, period, nu, E, M, a, e, i: i * this.RAD_TO_DEG };
            }
        }

        // ========== SATELLITE DEFINITIONS ==========
        const satellites = [
            {
                name: "ISS",
                semiMajor: 6778,
                eccentricity: 0.0006,
                inclination: 51.64,
                raan: 280.0,
                argPeriapsis: 250.0,
                meanAnomaly: 120.0,
                color: 0xff6347,
                size: 0.5
            },
            {
                name: "HUBBLE",
                semiMajor: 6964,
                eccentricity: 0.0002,
                inclination: 28.47,
                raan: 100.0,
                argPeriapsis: 130.0,
                meanAnomaly: 45.0,
                color: 0x00ffff,
                size: 0.4
            },
            {
                name: "GOES-16",
                semiMajor: 42164,
                eccentricity: 0.0001,
                inclination: 0.05,
                raan: 90.0,
                argPeriapsis: 0.0,
                meanAnomaly: 0.0,
                color: 0xffa500,
                size: 0.3
            },
            {
                name: "GPS-SAT-1",
                semiMajor: 26560,
                eccentricity: 0.014,
                inclination: 55.0,
                raan: 45.0,
                argPeriapsis: 200.0,
                meanAnomaly: 90.0,
                color: 0xffff00,
                size: 0.25
            },
            {
                name: "GLONASS-1",
                semiMajor: 25500,
                eccentricity: 0.005,
                inclination: 64.8,
                raan: 0.0,
                argPeriapsis: 180.0,
                meanAnomaly: 180.0,
                color: 0x00ff00,
                size: 0.25
            },
            {
                name: "GALILEO-1",
                semiMajor: 29600,
                eccentricity: 0.002,
                inclination: 56.0,
                raan: 270.0,
                argPeriapsis: 45.0,
                meanAnomaly: 270.0,
                color: 0xff00ff,
                size: 0.25
            },
            {
                name: "INSAT-3D",
                semiMajor: 42164,
                eccentricity: 0.0002,
                inclination: 0.1,
                raan: 180.0,
                argPeriapsis: 90.0,
                meanAnomaly: 180.0,
                color: 0x00ff88,
                size: 0.3
            }
        ];

        // ========== GLOBAL STATE ==========
        let state = {
            simRunning: true,
            view: '3d',
            selectedSat: null,
            speed: 1000,
            physics: new OrbitalPhysics()
        };

        let scene, camera, renderer;
        let satMeshes = {};
        let orbitLines = {};
        let canvasCtx = null;

        // ========== 3D SCENE INITIALIZATION ==========
        function init3D() {
            const canvas = document.getElementById('canvas');
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);
            scene.fog = new THREE.Fog(0x0a0a0a, 200, 500);

            camera = new THREE.PerspectiveCamera(
                60,
                canvas.clientWidth / canvas.clientHeight,
                0.1,
                100000
            );
            camera.position.set(0, 80, 100);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.shadowMap.enabled = true;

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x505050, 1);
            scene.add(ambientLight);

            const sunLight = new THREE.DirectionalLight(0xffffff, 1.5);
            sunLight.position.set(200, 200, 200);
            sunLight.castShadow = true;
            scene.add(sunLight);

            // EARTH
            const earthGeom = new THREE.SphereGeometry(10, 128, 128);
            const earthMat = new THREE.MeshPhongMaterial({
                color: 0x2233ff,
                shininess: 5,
                wireframe: false
            });
            const earth = new THREE.Mesh(earthGeom, earthMat);
            earth.castShadow = true;
            earth.receiveShadow = true;
            scene.add(earth);

            // ATMOSPHERE
            const atmGeom = new THREE.SphereGeometry(10.3, 64, 64);
            const atmMat = new THREE.MeshBasicMaterial({
                color: 0x00ff00,
                transparent: true,
                opacity: 0.1,
                wireframe: false
            });
            const atmosphere = new THREE.Mesh(atmGeom, atmMat);
            scene.add(atmosphere);

            // CREATE SATELLITES & ORBITS
            satellites.forEach((sat) => {
                // Satellite sphere
                const geom = new THREE.SphereGeometry(sat.size, 16, 16);
                const mat = new THREE.MeshStandardMaterial({
                    color: sat.color,
                    emissive: sat.color,
                    emissiveIntensity: 0.4,
                    metalness: 0.8
                });
                const mesh = new THREE.Mesh(geom, mat);
                mesh.castShadow = true;
                scene.add(mesh);
                satMeshes[sat.name] = mesh;

                // Orbit path
                const points = [];
                for (let i = 0; i <= 360; i += 5) {
                    const pos = state.physics.calculatePosition(sat, i * Math.PI / 180);
                    const scale = 0.01;
                    points.push(new THREE.Vector3(pos.x * scale, pos.y * scale, pos.z * scale));
                }
                const lineGeom = new THREE.BufferGeometry().setFromPoints(points);
                const lineMat = new THREE.LineBasicMaterial({
                    color: sat.color,
                    transparent: true,
                    opacity: 0.3
                });
                const line = new THREE.Line(lineGeom, lineMat);
                scene.add(line);
                orbitLines[sat.name] = line;
            });

            // MOUSE CONTROLS
            let isDragging = false;
            let mouse = { x: 0, y: 0 };

            canvas.addEventListener('mousedown', (e) => {
                isDragging = true;
                mouse = { x: e.clientX, y: e.clientY };
            });

            canvas.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const dx = e.clientX - mouse.x;
                    const dy = e.clientY - mouse.y;
                    camera.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), dx * 0.01);
                    camera.position.applyAxisAngle(
                        camera.getWorldDirection(new THREE.Vector3()).cross(new THREE.Vector3(0, 1, 0)),
                        dy * 0.01
                    );
                }
                mouse = { x: e.clientX, y: e.clientY };
            });

            canvas.addEventListener('mouseup', () => isDragging = false);
            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                camera.position.multiplyScalar(1 + e.deltaY * 0.0005);
            });

            animate3D();
        }

        function animate3D() {
            requestAnimationFrame(animate3D);

            if (state.simRunning) {
                state.physics.time += 0.016 * state.speed; // ~60fps
            }

            const scale = 0.01;

            satellites.forEach((sat) => {
                const pos = state.physics.calculatePosition(sat, state.physics.time);
                satMeshes[sat.name].position.set(pos.x * scale, pos.y * scale, pos.z * scale);
            });

            renderer.render(scene, camera);
        }

        // ========== 2D ORBITAL VIEW ==========
        function init2D() {
            const canvas = document.getElementById('canvas');
            canvasCtx = canvas.getContext('2d');
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
            animate2D();
        }

        function animate2D() {
            if (state.view !== '2d') {
                requestAnimationFrame(animate2D);
                return;
            }

            const canvas = document.getElementById('canvas');
            const w = canvas.width;
            const h = canvas.height;
            const centerX = w / 2;
            const centerY = h / 2;

            if (state.simRunning) {
                state.physics.time += 0.016 * state.speed;
            }

            // Clear
            canvasCtx.fillStyle = '#0a0a0a';
            canvasCtx.fillRect(0, 0, w, h);

            // Grid
            canvasCtx.strokeStyle = 'rgba(0, 255, 0, 0.1)';
            canvasCtx.lineWidth = 0.5;
            for (let i = 0; i < w; i += 50) {
                canvasCtx.beginPath();
                canvasCtx.moveTo(i, 0);
                canvasCtx.lineTo(i, h);
                canvasCtx.stroke();
            }
            for (let i = 0; i < h; i += 50) {
                canvasCtx.beginPath();
                canvasCtx.moveTo(0, i);
                canvasCtx.lineTo(w, i);
                canvasCtx.stroke();
            }

            // EARTH
            canvasCtx.fillStyle = '#2233ff';
            canvasCtx.beginPath();
            canvasCtx.arc(centerX, centerY, 10, 0, Math.PI * 2);
            canvasCtx.fill();

            // SATELLITES & ORBITS
            satellites.forEach((sat) => {
                const pos = state.physics.calculatePosition(sat, state.physics.time);
                const scale = 2;

                // Orbit circle
                const orbitRadius = Math.sqrt(pos.x * pos.x + pos.y * pos.y) * scale;
                canvasCtx.strokeStyle = `rgba(${(sat.color >> 16) & 255}, ${(sat.color >> 8) & 255}, ${sat.color & 255}, 0.2)`;
                canvasCtx.lineWidth = 1;
                canvasCtx.beginPath();
                canvasCtx.arc(centerX, centerY, orbitRadius, 0, Math.PI * 2);
                canvasCtx.stroke();

                // Satellite position
                const sx = centerX + pos.x * scale;
                const sy = centerY + pos.y * scale;

                canvasCtx.fillStyle = `rgb(${(sat.color >> 16) & 255}, ${(sat.color >> 8) & 255}, ${sat.color & 255})`;
                canvasCtx.beginPath();
                canvasCtx.arc(sx, sy, 4, 0, Math.PI * 2);
                canvasCtx.fill();

                // Label
                canvasCtx.fillStyle = '#00ff00';
                canvasCtx.font = 'bold 10px Arial';
                canvasCtx.fillText(sat.name, sx + 8, sy - 5);
            });

            requestAnimationFrame(animate2D);
        }

        // ========== UI FUNCTIONS ==========
        function switchView() {
            state.view = state.view === '3d' ? '2d' : '3d';
            document.getElementById('mode').textContent = state.view === '3d' ? '3D SPACE' : '2D ORBITAL';
            document.getElementById('viewBtn').textContent = state.view === '3d' ? '3D ‚Üí 2D' : '2D ‚Üí 3D';

            if (state.view === '2d') {
                init2D();
            } else {
                animate3D();
            }
        }

        function toggleSim() {
            state.simRunning = !state.simRunning;
            document.getElementById('simBtn').textContent = state.simRunning ? '‚è∏Ô∏è PAUSE' : '‚ñ∂Ô∏è PLAY';
        }

        function speedUp() {
            const speeds = [1, 10, 100, 1000, 5000];
            const idx = speeds.indexOf(state.speed);
            state.speed = speeds[(idx + 1) % speeds.length];
            document.getElementById('speedBtn').textContent = `‚è© ${state.speed}x`;
        }

        function resetView() {
            state.physics.time = 0;
            camera.position.set(0, 80, 100);
            camera.lookAt(0, 0, 0);
        }

        function selectSatellite(name) {
            state.selectedSat = name;
            updateInfo();
        }

        function updateInfo() {
            const list = document.getElementById('satList');
            list.innerHTML = '';

            satellites.forEach((sat) => {
                const pos = state.physics.calculatePosition(sat, state.physics.time);
                const div = document.createElement('div');
                div.className = 'satellite-item' + (state.selectedSat === sat.name ? ' active' : '');
                div.innerHTML = `
                    <div class="sat-name">${sat.name}</div>
                    <div class="sat-data">ALT: ${pos.altitude.toFixed(0)} km</div>
                    <div class="sat-data">DIST: ${pos.r.toFixed(0)} km</div>
                    <div class="sat-data">VEL: ${pos.v.toFixed(2)} km/s</div>
                    <div class="sat-data">PERIOD: ${(pos.period / 60).toFixed(1)} min</div>
                `;
                div.onclick = () => selectSatellite(sat.name);
                list.appendChild(div);
            });

            if (state.selectedSat) {
                const sat = satellites.find(s => s.name === state.selectedSat);
                const pos = state.physics.calculatePosition(sat, state.physics.time);
                document.getElementById('selectedInfo').innerHTML = `
                    <strong>${sat.name}</strong>
                    <div class="sat-data" style="margin-top: 6px;">
                        Altitude: ${pos.altitude.toFixed(0)} km
                        <br>Distance: ${pos.r.toFixed(0)} km
                        <br>Velocity: ${pos.v.toFixed(2)} km/s
                        <br>Period: ${(pos.period / 60).toFixed(1)} min
                        <br>Inclination: ${pos.i.toFixed(2)}¬∞
                    </div>
                `;
                document.getElementById('physicsInfo').innerHTML = `
                    <div class="sat-data">
                        Semi-major: ${sat.semiMajor.toFixed(0)} km
                        <br>Eccentricity: ${sat.eccentricity.toFixed(4)}
                        <br>True Anomaly: ${(pos.nu * 180 / Math.PI).toFixed(2)}¬∞
                        <br>Speed: ${state.speed}x
                    </div>
                `;
            }
        }

        // ========== MAIN LOOP ==========
        function updateTime() {
            const now = new Date();
            document.getElementById('time').textContent = now.toLocaleTimeString();
            updateInfo();
        }

        setInterval(updateTime, 100);

        window.addEventListener('load', () => {
            init3D();
            updateInfo();
        });

        window.addEventListener('resize', () => {
            const canvas = document.getElementById('canvas');
            camera.aspect = canvas.clientWidth / canvas.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        });
    </script>
</body>
</html>
